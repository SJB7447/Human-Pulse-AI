# 2026-02-25 Handoff

## 1) 오늘 작업 요약
- 커뮤니티 API 배포 오류(`FUNCTION_INVOCATION_FAILED`) 대응을 위해 Vercel lightweight 경로를 보강했습니다.
- 마이페이지 작성 기사 수정/재검증 흐름을 강화했습니다.
- 커뮤니티 페이지 인코딩 깨짐 텍스트를 복구하고, 기사 전체보기 UX를 카드 하단 확장에서 팝업 모달로 변경했습니다.
- 반려된 독자 기사를 작성자가 재승인 요청할 수 있는 서버/클라이언트 플로우를 추가했습니다.
- 관리자 독자 기사 영역에 대기열과 최근 7일 처리 이력을 분리하는 기반을 추가했습니다.

## 2) 오늘 반영한 핵심 변경
### A. 배포/런타임 안정화
- `/api/community` 예외 시 안전 응답 처리(서버 500 방지).
- Vercel lightweight 모드에서 `GET /api/community` 직접 처리 경로 추가.
- schema lag(컬럼 미적용) 상황에서 missing column/table 에러를 fallback 처리하도록 완화.

### B. 커뮤니티 UI/인코딩 복구
- `client/src/pages/community.tsx` 문자열 인코딩 깨짐 구간을 UTF-8 기준으로 정상화.
- 커뮤니티 게시물 전체보기 방식을 인라인 확장에서 모달 팝업으로 전환.

### C. 독자 기사 재승인 요청 플로우
- 신규 API: `POST /api/mypage/composed-articles/:id/resubmit`
  - 조건: `submissionStatus === rejected`인 본인 기사만 가능
  - 동작: 상태를 `pending`으로 전환, moderation 메타 초기화
- Storage 계층(Mem/Supabase)에 `resubmitUserComposedArticle` 구현.
- 마이페이지 `내가 쓴 기사` 탭에서 반려 기사에 `재승인 요청` 버튼 노출 및 즉시 상태 갱신.

### D. 관리자 독자 기사 검증 뷰 개선(1차)
- 독자 기사 조회를 pending-only에서 전체 조회로 확장.
- 화면에서 대기열(pending)과 최근 처리이력(approved/rejected, 7일) 분리 노출 기반 추가.

## 3) 오늘 수정 파일
- `api/index.ts`
- `api/vercel/lightweightReadRoutes.ts`
- `server/routes.ts`
- `server/storage.ts`
- `client/src/pages/community.tsx`
- `client/src/pages/mypage.tsx`
- `client/src/pages/admin.tsx`
- `client/src/services/DBService.ts`

## 4) 검증 메모
- `npm run typecheck` 통과.
- 로컬 재기동 후 API 확인:
  - `GET /api/community` 200
  - `POST /api/mypage/composed-articles/:id/resubmit` 라우트 응답 경로 확인(입력 누락 시 400)
  - `GET /api/admin/reader-articles` 200

## 5) TODO (다음 우선 작업)
### P0-1. 관리자 이전 기록 보기 고도화
- 관리자페이지 `이전 기록 보기(최근 7일)`에서 기사 전체보기 팝업 모달 제공.
- 이전 기록 목록 항목 삭제 기능 추가(소프트/하드 삭제 정책 결정 필요).
- 삭제 시 관리자 액션 로그와 연동.

### P0-2. 커뮤니티 작성자 편집 기능
- 커뮤니티 카드에서 작성자 본인 글인 경우 수정 진입 버튼 노출.
- 수정 저장 시 본문/요약/수정시각 반영.
- 권한 정책: 본인만 수정 가능, 관리자 override 여부 정책화.

### P0-3. 커뮤니티 댓글 CRUD
- 게시글 하단에 구독자 댓글 작성 기능 추가.
- 본인 댓글 수정/삭제 기능 추가.
- API/DB/권한/RLS 정책 설계 및 반영:
  - 댓글 생성/조회/수정/삭제 엔드포인트
  - 작성자/관리자 권한 분기
  - 악성/스팸 대응 최소 제어(길이 제한, rate limit 등)

## 6) 리스크/메모
- 현재 dev 실행 환경에서 watch 미동작 케이스가 있어 서버 코드 변경 후 재기동이 필요할 수 있음.
- 일부 로그 파일 경로 문자열은 콘솔에서 깨져 보일 수 있으나, 코드 파일 자체는 UTF-8 유지 필요.
